<div class="post">
    {%- if element.content -%}
        {% set contains_errors, content_tag = format_npf(element.content, element.layout, url_handler=url_handler) -%}
    {%- elif element.trail -%}
        {% set contains_errors, content_tag = format_npf(element.trail[0][1], element.trail[0][2], url_handler=url_handler) -%}
    {%- endif -%}

    <div class="post-header">
        <div class="post-author">
            <a href="/{{element.blog.name}}"><img class="avatar" loading="lazy" src="{{url_handler(element.blog.avatar[-1].url)}}"></a>
            <div class="author-information">
                <div class="primary-post-author">
                    <a class="link blog-name" href="/{{element.blog.name}}">{{element.blog.name}}</a>
                    <span class="separator">â€¢</span>
                    <span class="post-timestamp" title="{{element.date | format_datetime(locale="en")}}">
                        <a href="/{{element.blog.name}}/{{element.id}}/{{element.slug}}">
                            <time datetime="{{element.date.strftime("%Y-%m-%dT%H:%M")}}">{{element.date | format_date(locale="en")}}</time>
                        </a>
                    </span>
                </div>
                {%- if element.reblog_from -%}
                    {#- The reblog from data can sometimes have an empty blog name. Thus we'll extract the name from the root reblog info if they're the same-#}
                    {%- if not element.reblog_from.blog_name -%}
                        {%- if element.reblog_root and element.reblog_root.post_id == element.reblog_from.post_id -%}
                            {%- set reblog_post_author, reblog_post_id = element.reblog_root.blog_name, element.reblog_root.post_id -%}
                        {%- else -%}
                            {%- set reblog_post_author, reblog_post_id = "PRIVBLURERRORBLOG", element.reblog_from.post_id %}
                        {%- endif -%}
                    {%- else -%}
                        {%- set reblog_post_author, reblog_post_id = element.reblog_from.blog_name, element.reblog_from.post_id -%}
                    {%- endif -%}

                    <div class="reblog-attribution">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 -960 960 960" width="16"><path fill="#6b7280" d="M280-80 120-240l160-160 56 58-62 62h406v-160h80v240H274l62 62-56 58Zm-80-440v-240h486l-62-62 56-58 160 160-160 160-56-58 62-62H280v160h-80Z"/></svg>
                        <a class="link blog-name" href="/{{reblog_post_author}}/{{reblog_post_id}}">{{reblog_post_author}}</a>
                    </div>
                {%- endif -%}
            </div>
        </div>
    </div>

    {{- content_tag -}}

    <footer class="post-footer">
        {%- if element.tags -%}
            <div class="post-tags">
                {%- for tag in element.tags -%}
                    {% if blog is defined %}
                        <a class="post-tag" href="/{{blog.blog_info.name}}/tagged/{{tag | urlencode}}"><span>#{{tag | e}}</span></a>
                    {% else%}
                        <a class="post-tag" href="/tagged/{{tag | urlencode}}"><span>#{{tag | e}}</span></a>
                    {% endif %}
                {%- endfor -%}
            </div>
        {%- endif -%}

        <div class="post-interaction">
            <div class="note-count">
                <span> {{- translate("en", "post_note_count", element.note_count, element.note_count | format_decimal(locale="en_US")) }}</span>
            </div>
            <div class="interaction-buttons">
                <a href="/{{element.blog.name}}/{{element.id}}/{{element.slug}}">
                    <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20">
                        <title>Permalink </title>
                        <path fill="#d1d1d1"d="M695.967-78.477q-57.315 0-97.402-40.111-40.088-40.111-40.088-97.412 0-8.54 1-15.618 1-7.078 3-16.208L352.174-376.999q-16.695 18.261-39.788 26.391-23.094 8.131-48.386 8.131-57.301 0-97.412-40.121-40.111-40.12-40.111-97.435 0-57.315 40.111-97.402 40.111-40.088 97.412-40.088 25 0 48.239 8.631 23.24 8.63 39.935 25.891l210.303-129.173q-2-9.13-3-16.208-1-7.078-1-15.618 0-57.301 40.121-97.412 40.12-40.111 97.435-40.111 57.315 0 97.402 40.121 40.088 40.12 40.088 97.435 0 57.315-40.111 97.402-40.111 40.088-97.412 40.088-25.292 0-48.386-7.566-23.093-7.565-39.788-25.826L397.523-511.826q2 9.13 3 16.208 1 7.078 1 15.618t-1 15.618q-1 7.078-3 16.208l210.303 128.043q16.695-19.261 39.788-26.326 23.094-7.066 48.386-7.066 57.301 0 97.412 40.121 40.111 40.12 40.111 97.435 0 57.315-40.121 97.402-40.12 40.088-97.435 40.088Z"/>
                    </svg>
                </a>

                <a href="https://www.tumblr.com/{{element.blog.name}}/{{element.id}}">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 320 512" role="img" aria-label="View on Tumblr">
                        <!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                        <title>View on Tumblr </title>
                        <path fill="#d1d1d1" d="M309.8 480.3c-13.6 14.5-50 31.7-97.4 31.7-120.8 0-147-88.8-147-140.6v-144H17.9c-5.5 0-10-4.5-10-10v-68c0-7.2 4.5-13.6 11.3-16 62-21.8 81.5-76 84.3-117.1.8-11 6.5-16.3 16.1-16.3h70.9c5.5 0 10 4.5 10 10v115.2h83c5.5 0 10 4.4 10 9.9v81.7c0 5.5-4.5 10-10 10h-83.4V360c0 34.2 23.7 53.6 68 35.8 4.8-1.9 9-3.2 12.7-2.2 3.5.9 5.8 3.4 7.4 7.9l22 64.3c1.8 5 3.3 10.6-.4 14.5z"/>
                    </svg>
                </a>

            </div>
        </div>
    </footer>
</div>
